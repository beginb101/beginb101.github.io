---
layout: post
title: MySQL SQL 튜닝용어 (1)
description: >
  2022-09-13-MySQL SQL 튜닝용어 (1)
hide_description: false
category: dailydev
---

- Table of Contents
{:toc}

## DB 엔진 용어

__스토리지 엔진__<br>
스토리지 엔진은 사용자가 요청한 SQL 문을 토대로 DB에 저장된 디스크나 메모리에서 필요한 데이터를 가져오는 역활을 수행한다.
이후 해당 데이터를 MySQL 엔진으로 보내준다. 스토리지 엔진이 데이터를 저장하는 방식에 따라 온라인상의 트랜잭션 발생으로 데이터를 처리하는 OLTP환경에서는 InnoDB 엔진, 대량의 쓰기 트랜잭션이 발생하면 MyISAM엔진, 메모리 데이터를 로드하여 빠르게 읽는 효과를 내려면 Memory 엔진을 사용한다.<br>

__MySQL 엔진__<br>
SQL문의 시작 및 마무리 단계에 관여하며 스토리제 엔진으로부터 필요한 데이터만을 가져오는 역활을 하며, 사용자가 요청한 SQL문을 넘겨 받아 SQL문법 검사 적잘한 오브젝트 활용 검사를 하고, SQL문을 최소 단위로 분리하여 원하는 데이터를 빠르게 찾는 경로를 모색하는 역활을 수행한다.

## SQL 프로세스 용어
- 사용자가 SQL문을 수행하면 __파서__ 는 MySQL이 이해할수 있는 최소 단위로 구성요소를 분리하고 트리로 만든다. 
- 이후 __전처리기__ 는 생성된 트리 결과를 토대로, 이미 만들어진 테이블이나 뷰 등으로 구성되지는 않는지, 존재하지 않는 열을 포함하지는 않는지, 조회 권한이 없는 테이블을 조회하는지 등 유효성을 검증한다. 
- 이후 __옵티마이저__ 는 트리를 구성하는 오브젝트의 데이터를 효율적으로 가져오기 위해 시간은 적게 소요되면서 비용 효율적인 경로로 데이터를 검색하는 방법에 관한 실행 계획을 수립한다. 
- __엔진 실행기__ 는 이전에 수립된 실행 계획으로 스토리지 엔진을 호출해 필요한 데이터를 가져온다. 이후 엔진 실행기는 가져온 데이터 중 불필요한 데이터를 필러링하여 원하는 결과를 전달 한다.

## 파서
파서는 MySQL 엔진에 포함되는 오브젝트로, 사용자가 요청한 SQL문을 쪼개 최소 단위로 분리하고 트리를 만든다. 트리를 만들면서 문법 검사를 수행한다.

## 전처리기 
전처리기는 MySQL 엔진에 해당하는 오브젝트로 파서에서 생성한 트리를 토대로 SQL문에 구조적인 문제가 없는지 파악한다. SQL문에 작성된 오브젝트가 생성된 오브젝트인지, 접근 권한 확인하는 역활을 한다.

## 옵티마이저 
옵티마이저는 MySQL의 핵심 엔진 중 하나로, 전달된 파서 트리를 토대로 필요하지 않은 조건은 제거하거나 연산과정을 단순화한다. 또한 실행 계획을 수립한다. 단 모든 실행 계획을 판단하지않기 때문에 최상의 실행 계획이 아닐수도 있기 때문에 적절히 다루는 개발자의 손길이 필요하다.

## 엔진 실행기
엔진 실행기는 MySQL 엔진과 스토리지 엔진 영역에 모두에 걸치는 오브젝트다. 옵티마이저에서 수립한 실행 계획을 참고하여 스토리지 엔진에서 데이터를 가져온다. 이후 데이터 정렬, 조인, 불필요한 데이터는 필터링 처리하는 추가 작업을 한다. 따라서 MySQL 엔진의 부하를 줄이려면 스토리지 엔진에서 가져오는 데이터양을 줄이는 게 매우 중요하다.

## DB 오브젝트 용어
데이터베이스를 구성하는 요소 중 하나로 오브젝트 라 불리는 객체들이 있다. 2차원 형태의 관계형 데이터베이스에서 표는 테이블, 열은 컬럼 행은 로우라는 용어로 사용한다.

## 테이블
테이블은 데이터를 저장하는 오브젝트로 행과 열의 정보를 담는다.
MySQL은 2차원 배열 형태로 테이블을 관리한다. 테이블에서는 저장 방식과 저장 구조에 따라 스토리지 엔진 속성을 정의할 수 있다. InnoDB 스토리지 엔진은 보통 OLTP환경에서 주로 사용하는 기본 DB엔진이다.

## 로우(행)
테이블에서 동일한 구조의 데이터 항목들의 집합을 가리킨다. 즉 하나의 데이터 항목 집합이며 모든 행의 집합이 테이블이라고 할 수 있다. 행 수가 많아지면 데이터에 접근하는 과정에서 시간이 오래 소요될 가능성이 있는데 이때 파티셔닝 기법으로 SQL문의 성능 향상을 검토할 수 있다.

## 컬럼(열)
사전에 정의한 데이터 유형으로 데이터 값을 저장하며, 열별로 다른 데이터 유형을 가질 수 있다.

## 기본키 
primary key(PK)는 특정 행을 대표하는 열을 가리키는 용어로 주 키 라고도 한다. 각 테이블에서 1개의 열만으로 생성하지만 상황에 따라 2개이상의 열을 조합해 키본 키를 구성할 수도 있다. 또한 기본 키는 인덱스 역활도 수행하므로 기본 키를 활용하여 인덱싱할 수 있다. MySQL에서는 기본 키는 클러스터형 인덱스로 작동한다. 

## 외래 키
foreign key(FK)는 외부에 있는 테이블을 항상 참조하면서, 외부 테이블의 데이터가 변경되면 함께 영향을 받는 관계를 설정하는 키이다. 외부 키가 설정된 열에 참조하는 외부테이블에 없는 데이터를 삽입하거나 수정하려면 에러가 발생할 것이다.

## 인덱스
인덱스는 데이터베이스에서 키값으로 실제 데이터 위치를 식별하고 데이터 접근속도를 높이고자 생성되는 키 기준으로 정렬된 오브젝트이다.
인덱스는 생성하려는 열의 속성에 따라 고유 인덱스와 비고유 인덱스로 구분할 수 있다. <br>
__고유 인덱스__<br
고유 인덱스는 말 그대로 인덱스를 구성하는 열들의 데이터가 유일하다는 의미이다. 만약 동일한 데이터가 생성되면 에러가 발생한다. 또한 중복이 없는 열들을 고유 인덱스로 생성하려 한다면 중복이 있느지 검증하는 절차를 거쳐야한다.<br>
__비고유 인덱스__<br>
비고유 인덱스는 고유 인덱스에서 데이터의 유일한 속성만 제외한 키이다.
열의 중복 체크를 거치지 않고 단순한 정렬 작업을 수행한다.

## 뷰
가상 테이블이라고 이해하면된다. 물리적으로는 잡히지 않는 테이블이라고 볼 수 있다. 뷰는 외부에 테이블의 정보를 전부 보여주지 않고 제한적으로 제공할 수 있는 장점이 있다.

## 서브쿼리 위치에 따른 SQL 용어 -스칼라 서브쿼리
메인쿼리의 SELECT 절에 있는 또 다른 SELECT절이 스칼라 서브쿼리이다.
메인쿼리의 SELECT 절에는 최종 출력하려는 열들이 나열되므로 출력 데이터 1건과 스칼라 서브쿼리의 결과 건수가 일치해야 한다. 즉 스칼라 서브쿼리의 결괏값은 1행 1열 구조로 출력되어야 한다. 

## 서브쿼리 위치에 따른 SQL 용어 -인라인 뷰
메인쿼리의 FROM절에 있는 SELECT절이 인라인 뷰이다. FROM 내부에서 일시적으로 뷰를 생성하는 방식이므로 인라인 뷰라고 불린다. 인라인 뷰의 결과는 내부적으로 메모리 또는 디스크에 임시 테이블을 생성하여 활용한다.

## 서브쿼리 위치에 따른 SQL 용어 -중첩 서브쿼리
메인쿼리의 WHERE절에 있는 SELECT 문이다. WHERE절에서 단순한 값을 비교하는 대신 서브쿼리를 추가하여 비교 연산하기 위해 중첩 서브쿼리를 사용한다. 비교 연산자를 비롯해 IN, EXISTS, NOT IN, NOT EXISTS문을 많이 사용한다.

## 메인쿼리와의 관계성에 따른 SQL 용어 -비상관 서브쿼리
비상관 서브쿼리는 메인쿼리와 서브쿼리 간에 관계성이 없는 의미이다.
즉 서브쿼리가 독자적으로 실행된 뒤 메인쿼리에 그 결과를 던져주는 형태이다. 서브쿼리 -> 메인쿼리 실행의 순서로 실행된다.

## 메인쿼리와의 관계성에 따른 SQL 용어 -상관 서브쿼리
상관 서브쿼리는 메인쿼리와 서브쿼리 간에 관계성이 있음을 의미한다.
이러한 상관 서브쿼리는 SELECT절에 작성하는 스칼라 서브쿼리와 WHERE 절에 작성하는 중첩 서브쿼리일 때 발생한다. 메인쿼리 실행 -> 서브쿼리 실행 -> 다시 메인쿼리 실행한 뒤 결과 출력 순으로 실행된다.

## 반환 결과에 따른 SQL 용어 -단일행 서브쿼리
단일행 서브쿼리는 서브쿼리 결과가 1건의 행으로 반환되는 쿼리이다.
SELECT 절에서 사용하는 스칼라 서브쿼리와 동일하다고 볼 수 있다.

## 반환 결과에 따른 SQL 용어 -다중행 서브쿼리
다중행 서브쿼리는 서브쿼리 결과가 여러 건의 행으로 반환되는 쿼리이다.
그에 따라 메인쿼리의 조건절에서는 IN구문으로 서브쿼리에서 반환되는 값들을 받는다.

## 반환 결과에 따른 SQL 용어 -다중열 서브쿼리
다중열 서브쿼리는 서브쿼리 결과가 여러 개의 열과 행으로 반환된다.
그에 따라 메인쿼리의 조건절에서는 IN구문과 함께 서브쿼리에서 반환될 열들을 동일하게 나열해 서브쿼리 결과를 받는다.

## 참고 문헌

[업무에 바로 쓰는 SQL 튜닝](http://www.yes24.com/Product/Goods/102382080)
